<svg viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="authGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#6366f1"/>
      <stop offset="100%" style="stop-color:#8b5cf6"/>
    </linearGradient>
    <filter id="shadow3" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.15"/>
    </filter>
    <marker id="arr" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#64748b"/>
    </marker>
  </defs>

  <rect width="800" height="600" fill="#f1f5f9"/>
  <text x="400" y="35" text-anchor="middle" font-family="system-ui" font-size="20" font-weight="bold" fill="#1e293b">Session-based Authentication System</text>

  <!-- Login Flow -->
  <g filter="url(#shadow3)">
    <rect x="30" y="60" width="350" height="250" rx="10" fill="white" stroke="#e2e8f0" stroke-width="2"/>
    <rect x="30" y="60" width="350" height="35" rx="10" fill="url(#authGrad)"/>
    <text x="205" y="83" text-anchor="middle" font-family="system-ui" font-size="13" font-weight="600" fill="white">Login Flow</text>
  </g>

  <!-- Login Steps -->
  <g font-family="system-ui" font-size="10">
    <rect x="50" y="110" width="310" height="25" rx="4" fill="#dbeafe"/>
    <text x="60" y="127" fill="#1e40af">1. POST /auth/login { email, password }</text>

    <rect x="50" y="145" width="310" height="25" rx="4" fill="#fef3c7"/>
    <text x="60" y="162" fill="#92400e">2. Verify password (bcrypt compare)</text>

    <rect x="50" y="180" width="310" height="25" rx="4" fill="#fee2e2"/>
    <text x="60" y="197" fill="#991b1b">3. Check banned status (user + BannedUser)</text>

    <rect x="50" y="215" width="310" height="25" rx="4" fill="#dcfce7"/>
    <text x="60" y="232" fill="#166534">4. Create Session (30-day expiry)</text>

    <rect x="50" y="250" width="310" height="25" rx="4" fill="#e0e7ff"/>
    <text x="60" y="267" fill="#4338ca">5. Set HttpOnly cookie + track device</text>
  </g>

  <!-- OAuth Flow -->
  <g filter="url(#shadow3)">
    <rect x="420" y="60" width="350" height="250" rx="10" fill="white" stroke="#e2e8f0" stroke-width="2"/>
    <rect x="420" y="60" width="350" height="35" rx="10" fill="#ea580c"/>
    <text x="595" y="83" text-anchor="middle" font-family="system-ui" font-size="13" font-weight="600" fill="white">Google/Apple OAuth Flow</text>
  </g>

  <!-- OAuth Steps -->
  <g font-family="system-ui" font-size="10">
    <rect x="440" y="110" width="310" height="25" rx="4" fill="#fed7aa"/>
    <text x="450" y="127" fill="#c2410c">1. User clicks "Sign in with Google"</text>

    <rect x="440" y="145" width="310" height="25" rx="4" fill="#fed7aa"/>
    <text x="450" y="162" fill="#c2410c">2. Redirect to provider OAuth page</text>

    <rect x="440" y="180" width="310" height="25" rx="4" fill="#fed7aa"/>
    <text x="450" y="197" fill="#c2410c">3. Callback with auth code</text>

    <rect x="440" y="215" width="310" height="25" rx="4" fill="#dcfce7"/>
    <text x="450" y="232" fill="#166534">4. Exchange code → tokens → profile</text>

    <rect x="440" y="250" width="310" height="25" rx="4" fill="#e0e7ff"/>
    <text x="450" y="267" fill="#4338ca">5. Find/create user, session, cookie</text>
  </g>

  <!-- Session Storage -->
  <g filter="url(#shadow3)">
    <rect x="30" y="330" width="230" height="240" rx="10" fill="white" stroke="#e2e8f0" stroke-width="2"/>
    <rect x="30" y="330" width="230" height="35" rx="10" fill="#0891b2"/>
    <text x="145" y="353" text-anchor="middle" font-family="system-ui" font-size="13" font-weight="600" fill="white">Session Model</text>
  </g>

  <g font-family="monospace" font-size="9">
    <text x="50" y="385" fill="#0e7490">Session {</text>
    <text x="60" y="402" fill="#64748b">id: UUID (cookie)</text>
    <text x="60" y="419" fill="#64748b">publicId: UUID (frontend)</text>
    <text x="60" y="436" fill="#64748b">userId: FK → User</text>
    <text x="60" y="453" fill="#64748b">expiresAt: DateTime</text>
    <text x="60" y="470" fill="#64748b">createdAt: DateTime</text>
    <text x="50" y="487" fill="#0e7490">}</text>

    <text x="50" y="515" fill="#0e7490">DeviceSession {</text>
    <text x="60" y="532" fill="#64748b">browser, OS, IP, userAgent</text>
    <text x="50" y="549" fill="#0e7490">}</text>
  </g>

  <!-- Cookie Config -->
  <g filter="url(#shadow3)">
    <rect x="285" y="330" width="230" height="130" rx="10" fill="white" stroke="#e2e8f0" stroke-width="2"/>
    <rect x="285" y="330" width="230" height="35" rx="10" fill="#dc2626"/>
    <text x="400" y="353" text-anchor="middle" font-family="system-ui" font-size="13" font-weight="600" fill="white">Cookie Security</text>
  </g>

  <g font-family="system-ui" font-size="10">
    <text x="300" y="385" fill="#dc2626" font-weight="600">httpOnly: true</text>
    <text x="300" y="402" fill="#64748b">→ Prevents XSS access</text>
    <text x="300" y="422" fill="#dc2626" font-weight="600">secure: true (prod)</text>
    <text x="300" y="439" fill="#64748b">→ HTTPS only</text>
  </g>

  <!-- Ban Enforcement -->
  <g filter="url(#shadow3)">
    <rect x="540" y="330" width="230" height="240" rx="10" fill="white" stroke="#e2e8f0" stroke-width="2"/>
    <rect x="540" y="330" width="230" height="35" rx="10" fill="#7c2d12"/>
    <text x="655" y="353" text-anchor="middle" font-family="system-ui" font-size="13" font-weight="600" fill="white">Ban Enforcement</text>
  </g>

  <g font-family="system-ui" font-size="10">
    <rect x="555" y="380" width="200" height="22" rx="3" fill="#fee2e2"/>
    <text x="565" y="395" fill="#991b1b">1. Set isBanned = true</text>

    <rect x="555" y="410" width="200" height="22" rx="3" fill="#fee2e2"/>
    <text x="565" y="425" fill="#991b1b">2. Create BannedUser record</text>

    <rect x="555" y="440" width="200" height="22" rx="3" fill="#fee2e2"/>
    <text x="565" y="455" fill="#991b1b">3. DELETE all sessions</text>

    <rect x="555" y="470" width="200" height="22" rx="3" fill="#dcfce7"/>
    <text x="565" y="485" fill="#166534">→ Instant logout everywhere</text>

    <rect x="555" y="500" width="200" height="35" rx="3" fill="#fef3c7"/>
    <text x="565" y="515" fill="#92400e">Future logins check:</text>
    <text x="565" y="528" fill="#92400e">• user.isBanned • BannedUser</text>
  </g>

  <!-- Validation Flow Arrow -->
  <g filter="url(#shadow3)">
    <rect x="285" y="480" width="230" height="90" rx="10" fill="white" stroke="#e2e8f0" stroke-width="2"/>
    <rect x="285" y="480" width="230" height="30" rx="10" fill="#16a34a"/>
    <text x="400" y="500" text-anchor="middle" font-family="system-ui" font-size="11" font-weight="600" fill="white">Request Validation</text>
  </g>

  <g font-family="monospace" font-size="9">
    <text x="300" y="530" fill="#166534">getCurrentUser(sessionId)</text>
    <text x="300" y="545" fill="#64748b">→ Lookup session in DB</text>
    <text x="300" y="560" fill="#64748b">→ Check expiry, return user</text>
  </g>
</svg>
